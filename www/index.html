<!DOCTYPE html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Keywords" content="turismo, a񡮡" />
<meta name="Description" content="turismo a񡮡" />

<!--Declare page as mobile friendly --> 
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0"/>
<!-- Declare page as iDevice WebApp friendly -->
<meta name="apple-mobile-web-app-capable" content="yes"/>
<!-- iDevice WebApp Splash Screen, Regular Icon, iPhone, iPad, iPod Retina Icons -->
<link rel="apple-touch-icon" sizes="114x114" href="images/splash/splash-icon.png"> 
<link rel="apple-touch-startup-image" href="images/splash/splash-screen.png" media="screen and (max-device-width: 320px)" /> 
<link rel="apple-touch-startup-image" href="images/splash/splash-screen@2x.png" media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" /> 
<link rel="apple-touch-startup-image" href="images/splash/splash-screen@3x.png" sizes="640x1096">

<script type="text/javascript" charset="utf-8" src="cordova.js"></script> 

<!-- Page Title -->
<title>Dr Hidalgo</title>
<script src="scripts/jquery.min.js" type="text/javascript"></script> 
<script src="scripts/jquery-ui-min.js" type="text/javascript"></script>
<!-- Stylesheet Load -->

<link href="styles/style.css" rel="stylesheet" type="text/css">
<link href="styles/framework-style.css" rel="stylesheet" type="text/css">
<link href="styles/framework.css" rel="stylesheet" type="text/css">
<link href="styles/icons.css" rel="stylesheet" 	type="text/css">
<link href="styles/retina.css" rel="stylesheet" type="text/css" media="only screen and (-webkit-min-device-pixel-ratio: 2)" /><script src="scripts/swipe.js" type="text/javascript"></script>
<script src="scripts/retina.js" type="text/javascript"></script>
<script src="scripts/modernizr.js" type="text/javascript"></script>
<script src="scripts/slicebox.js" type="text/javascript"></script>
<script src="scripts/custom.js" type="text/javascript"></script>

<script type="text/javascript" charset="utf-8">

    var pictureSource;   // picture source
    var destinationType; // sets the format of returned value 


    // Wait for PhoneGap to load
    document.addEventListener("deviceready", onDeviceReady, false);
    // PhoneGap is ready
    function onDeviceReady() {
        console.log("Devide Ready");
        pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
        //$("#camaras").hide();
        $("#preloader").hide(); // will fade out the white DIV that covers the website.
        /* $("#mostrar").click(function() {
            $("#camaras").slideDown("slow");
        });*/
    }
    
    // Funcion que sube el post
    function uploadPhoto(imageURI) {
        console.log("Somos uploadPhoto. VAMOS A SUBIR "+imageURI);
        
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        
        var params = new Object();
        params.value1 = "test";
        params.value2 = "param";
        
        options.params = params;
        options.chunkedMode = false;
        
        var url = 'http://sanfermines.ihealthortovas.com/mobile.php';
        var form_data = {
            titulo: $("#titulo").val(),
            categoria: $("#categoria").val(),
            texto: $("#texto").val(),
            is_ajax: 1
        };
        //alert($("#titulo").val());
        console.log("Hacemos el POST");
        $.post(url, form_data, function(data) {
            console.log("POST hecho");
            console.log(data);
        });
        var ft = new FileTransfer();
        console.log("Subimos la imagen");
        ft.upload(imageURI, encodeURI("http://sanfermines.ihealthortovas.com/mobile.php"), win, onFail, options);
        var pic1 = document.getElementById("image"); 
        // que hace esto??? if (image == typeof('image')) return;
        pic1.src = imageURI;
    }

    function onPhotoURISuccess(imageURI) {
        console.log("SOMOS onPhotoURISuccess");
        // Uncomment to view the image file URI 
        console.log(imageURI);

        uploadPhoto(imageURI);
        // Get image handle
        //
        var largeImage = document.getElementById('image ');

        // Unhide image elements
        //
        largeImage.style.display = 'block';

        // Show the captured photo
        // The inline CSS rules are used to resize the image
        //
        largeImage.src = imageURI;
        console.log("FIN onPhotoURISuccess");
    }

    function capturePhoto() {
      // Take picture using device camera and retrieve image 
      navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 30,
        destinationType: destinationType.FILE_URI });
    }

    function getPhoto(source) {
      // Retrieve image file location from specified source
      navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 30, 
        destinationType: destinationType.FILE_URI,
        sourceType: source });
    }

    // Called if something bad happens.
    // 
    function onFail(message) {
      alert('Failed because: ' + message);
    }
    function win(r) {
        $("#status").fadeIn(); 
        $("#preloader").fadeIn(500);
        
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        var delay = 3000; 

        setTimeout(function(){ 
            $("#status").fadeOut(); 
            $("#preloader").fadeOut(500); 
            $("#titulo").val("");
            $("#categoria").val("");
            $("#texto").val("");
            $("#image").attr("src","second.jpg");
            //$("#camaras").slideUp("slow");
            
            }, delay);
    }
</script>
</head>
<body>
<div id="preloader">
	<div id="status">
    	<p class="center-text">
			<em>Enviando foto...</em>
            <em>La carga depende de la velocidad de tu conexión</em>
        </p>
       </div>
</div>

<div class="header-decoration"></div>

<div class="landing-header">
	<img class="landing-logo replace-2x" src="images/logo/logo.png"  alt="img" width="148">
</div>
<center> 
    <form id="noticia" action="" method="post">
        <fieldset>
            <legend>Introducir entrada del blog</legend>
            <input type="hidden" name="URI" id="URI" value="" />
            <input type="text" name="titulo" id="titulo" placeholder="Título del post" required="required" />
            <select name="categoria"> 
                <option value="nosotros">Nosotros</option> 
                <option value="encierros">Encierros</option> 
                <option value="corridas">Corridas</option> 
                <option value="anecdotas">Anécdotas</option>
            </select>
            <br>
            <textarea name="texto" id="texto" placeholder="Texto del post" required="required"></textarea>
          </fieldset>
        <!-- <button class="demo-button button-minimal black-minimal" id="mostrar">Foto</button>  -->
       </form>
</center>

<div class="header-decoration"></div>
<center id="camaras">
    <button onclick="getPhoto(pictureSource.PHOTOLIBRARY);" class="demo-button button-minimal black-minimal">elige foto</button>
    <button onclick="capturePhoto();" class="demo-button button-minimal black-minimal">haz foto</button>
    <img src="" id="image" width="320" >
</center>
</body>
</html>
